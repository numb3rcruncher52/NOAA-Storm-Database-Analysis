---
title: "NOAA-Storm-Analysis"
author: "Max Lyons"
date: "July 9, 2016"
output: html_document
---

## Synopsis
This is an analysis of the U.S. National Oceanic and Atmospheric 
Administration's (NOAA) storm database for the reproducible research course
on Coursera. The goal of the analysis is to determine which types of storm 
events have the greatest impact on 1) population health and 2) the economy
across the U.S.


## Data Processing
The first step in our analysis is pulling the data from the Coursera website,
storing it in a dataframe, and caching the result since it's a moderately
large dataset:
```{r, cache=TRUE}
library(dplyr)
data_url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(data_url,"NOAAdata.csv.bz2", method="curl")
storms <- read.csv("NOAAdata.csv.bz2",stringsAsFactors = FALSE)
```
Let's quickly check the structure of the dataset to see what fields are 
available and compare to the online information about the storm database.
```{r}
str(storms)
```
The dataset appears to have information about a few major categories: location,
time span, fatalities/injuries, and damage. Since we know that we want to 
identify the types of events that have the biggest impact on population health 
and the economy, we will focus on the fatalities/injuries, damage, and event
type data.
```{r}
storms2 <- storms %>% select(EVTYPE, FATALITIES, INJURIES, PROPDMG:CROPDMGEXP, REMARKS)
```
Let's look at each of our fields to see what kind of preprocessing we may need
to do:
### EVTYPE
```{r}
storm_types <- storms2 %>% count(EVTYPE) %>% arrange(-n)
storm_types
summary(storm_types$n)
```
We can see that there are 985 different labels for storms, and looking at the
summary of the counts for each type, at least 75% of the labels have occurences
of 5 or less. We will need to go through and clean up some of the labels, but
let's see if we can reduce the total number of labels by focusing on the types
of storms that effect population health or the economy.
### FATALITIES & INJURIES: Population Health
According to the National Weather Service Documentation, Direct fatalities and
injuries from storms are classified in the FATALITIES and INJURIES columns. We 
will use these columns without any additional processing to evaluate population
health.
### Economy
There are four fields that are utilized to provide information about the 
economic impact of the storms: PROPDMG, PROPDMGEXP, CROPDMG, and CROPDMGEXP.
Both PROPDMG and CROPDMG list the damage amounts for property and crops, 
respectively, and the other two columns give a unit of measure. We will need to
combine the values and unit of measure columns to compare damage across all 
storms. Let's check out the different units of measure:
```{r}
table(storms2$PROPDMGEXP)
table(storms2$CROPDMGEXP)
```
From these tables we can see units of measure for thousands (k/K), 
millions (M/m), and billions (B/b). I will also assume that (h/H) is hundreds, 
and we will have to investigate the (?) and the single numbers:
```{r}
check_uom <- c('?','+','-','0','1','2','3','4','5','6','7','8')
questions <- storms2 %>% filter((PROPDMGEXP %in% check_uom) | 
                                    (CROPDMGEXP %in% check_uom))
```
After looking into all the strange units of measure it appears that there isn't
any specific pattern to having a number as the unit of measure, but there are 
multiple instances in the Remarks that mentions damage of some kind. Since the 
most common unit of measure by far is thousands, I will simply replace any of 
these strange units of measure with thousands.
```{r}
storms2 <- storms2 %>% 
    mutate(PROPDMGEXP = ifelse(PROPDMGEXP %in% check_uom, 'K', toupper(PROPDMGEXP)), 
           CROPDMGEXP = ifelse(CROPDMGEXP %in% check_uom, 'K', toupper(CROPDMGEXP)))
```




```{r}
summary(storms$FATALITIES)
summary(storms$INJURIES)
```
From basic summaries of the data, we can tell that most storms don't cause a 
single injury or fatality, as the median of both columns is 0. Let's figure out
what percentage of storms have at least one injury or fatality, and then look at
a summary of that subset of data
```{r}
sum(storms$FATALITIES[storms$FATALITIES >= 1])/nrow(storms)*100
sum(storms$INJURIES[storms$INJURIES >= 1])/nrow(storms)*100
```



## Results